var X=Object.defineProperty;var Z=(t,e,o)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var m=(t,e,o)=>(Z(t,typeof e!="symbol"?e+"":e,o),o);const Q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}};Q();var K=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function P(t,e,o,s){t.addEventListener?t.addEventListener(e,o,s):t.attachEvent&&t.attachEvent("on".concat(e),function(){o(window.event)})}function V(t,e){for(var o=e.slice(0,e.length-1),s=0;s<o.length;s++)o[s]=t[o[s].toLowerCase()];return o}function $(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");for(var e=t.split(","),o=e.lastIndexOf("");o>=0;)e[o-1]+=",",e.splice(o,1),o=e.lastIndexOf("");return e}function W(t,e){for(var o=t.length>=e.length?t:e,s=t.length>=e.length?e:t,i=!0,r=0;r<o.length;r++)s.indexOf(o[r])===-1&&(i=!1);return i}var D={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":K?173:189,"=":K?61:187,";":K?59:186,"'":222,"[":219,"]":221,"\\":220},E={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},B={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},y={16:!1,18:!1,17:!1,91:!1},h={};for(var j=1;j<20;j++)D["f".concat(j)]=111+j;var u=[],G=!1,q="all",F=[],x=function(e){return D[e.toLowerCase()]||E[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function J(t){q=t||"all"}function C(){return q||"all"}function z(){return u.slice(0)}function ee(t){var e=t.target||t.srcElement,o=e.tagName,s=!0;return(e.isContentEditable||(o==="INPUT"||o==="TEXTAREA"||o==="SELECT")&&!e.readOnly)&&(s=!1),s}function te(t){return typeof t=="string"&&(t=x(t)),u.indexOf(t)!==-1}function oe(t,e){var o,s;t||(t=C());for(var i in h)if(Object.prototype.hasOwnProperty.call(h,i))for(o=h[i],s=0;s<o.length;)o[s].scope===t?o.splice(s,1):s++;C()===t&&J(e||"all")}function se(t){var e=t.keyCode||t.which||t.charCode,o=u.indexOf(e);if(o>=0&&u.splice(o,1),t.key&&t.key.toLowerCase()==="meta"&&u.splice(0,u.length),(e===93||e===224)&&(e=91),e in y){y[e]=!1;for(var s in E)E[s]===e&&(v[s]=!1)}}function ie(t){if(typeof t>"u")Object.keys(h).forEach(function(n){return delete h[n]});else if(Array.isArray(t))t.forEach(function(n){n.key&&A(n)});else if(typeof t=="object")t.key&&A(t);else if(typeof t=="string"){for(var e=arguments.length,o=new Array(e>1?e-1:0),s=1;s<e;s++)o[s-1]=arguments[s];var i=o[0],r=o[1];typeof i=="function"&&(r=i,i=""),A({key:t,scope:i,method:r,splitKey:"+"})}}var A=function(e){var o=e.key,s=e.scope,i=e.method,r=e.splitKey,n=r===void 0?"+":r,f=$(o);f.forEach(function(l){var a=l.split(n),c=a.length,d=a[c-1],p=d==="*"?"*":x(d);if(!!h[p]){s||(s=C());var O=c>1?V(E,a):[];h[p]=h[p].filter(function(g){var w=i?g.method===i:!0;return!(w&&g.scope===s&&W(g.mods,O))})}})};function U(t,e,o,s){if(e.element===s){var i;if(e.scope===o||e.scope==="all"){i=e.mods.length>0;for(var r in y)Object.prototype.hasOwnProperty.call(y,r)&&(!y[r]&&e.mods.indexOf(+r)>-1||y[r]&&e.mods.indexOf(+r)===-1)&&(i=!1);(e.mods.length===0&&!y[16]&&!y[18]&&!y[17]&&!y[91]||i||e.shortcut==="*")&&e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}}function N(t,e){var o=h["*"],s=t.keyCode||t.which||t.charCode;if(!!v.filter.call(this,t)){if((s===93||s===224)&&(s=91),u.indexOf(s)===-1&&s!==229&&u.push(s),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(g){var w=B[g];t[g]&&u.indexOf(w)===-1?u.push(w):!t[g]&&u.indexOf(w)>-1?u.splice(u.indexOf(w),1):g==="metaKey"&&t[g]&&u.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(u=u.slice(u.indexOf(w))))}),s in y){y[s]=!0;for(var i in E)E[i]===s&&(v[i]=!0);if(!o)return}for(var r in y)Object.prototype.hasOwnProperty.call(y,r)&&(y[r]=t[B[r]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(u.indexOf(17)===-1&&u.push(17),u.indexOf(18)===-1&&u.push(18),y[17]=!0,y[18]=!0);var n=C();if(o)for(var f=0;f<o.length;f++)o[f].scope===n&&(t.type==="keydown"&&o[f].keydown||t.type==="keyup"&&o[f].keyup)&&U(t,o[f],n,e);if(s in h){for(var l=0;l<h[s].length;l++)if((t.type==="keydown"&&h[s][l].keydown||t.type==="keyup"&&h[s][l].keyup)&&h[s][l].key){for(var a=h[s][l],c=a.splitKey,d=a.key.split(c),p=[],O=0;O<d.length;O++)p.push(x(d[O]));p.sort().join("")===u.sort().join("")&&U(t,a,n,e)}}}}function re(t){return F.indexOf(t)>-1}function v(t,e,o){u=[];var s=$(t),i=[],r="all",n=document,f=0,l=!1,a=!0,c="+",d=!1;for(o===void 0&&typeof e=="function"&&(o=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(r=e.scope),e.element&&(n=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(a=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(c=e.splitKey)),typeof e=="string"&&(r=e);f<s.length;f++)t=s[f].split(c),i=[],t.length>1&&(i=V(E,t)),t=t[t.length-1],t=t==="*"?"*":x(t),t in h||(h[t]=[]),h[t].push({keyup:l,keydown:a,scope:r,mods:i,shortcut:s[f],method:o,key:s[f],splitKey:c,element:n});typeof n<"u"&&!re(n)&&window&&(F.push(n),P(n,"keydown",function(p){N(p,n)},d),G||(G=!0,P(window,"focus",function(){u=[]},d)),P(n,"keyup",function(p){N(p,n),se(p)},d))}function ne(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(h).forEach(function(o){var s=h[o].find(function(i){return i.scope===e&&i.shortcut===t});s&&s.method&&s.method()})}var M={setScope:J,getScope:C,deleteScope:oe,getPressedKeyCodes:z,isPressed:te,filter:ee,trigger:ne,unbind:ie,keyMap:D,modifier:E,modifierMap:B};for(var S in M)Object.prototype.hasOwnProperty.call(M,S)&&(v[S]=M[S]);if(typeof window<"u"){var le=window.hotkeys;v.noConflict=function(t){return t&&window.hotkeys===v&&(window.hotkeys=le),v},window.hotkeys=v}class H{constructor(e,o,s){m(this,"cells");this.rows=e,this.columns=o,this.rows=e,this.columns=o,this.cells=Array.from(new Array(e),()=>Array.from(new Array(o),()=>s))}*keys(e){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++){const i=this.cells[o][s];e&&!e(i)||(yield[o,s])}}*entries(e){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++){const i=this.cells[o][s];e&&!e(i)||(yield[o,s,i])}}}function ae(t){const e=t.length,o=t[0].length,s=t[0][0],i=new H(e,o,s);for(const[r,n]of i.keys())i.cells[r][n]=t[r][n];return i}var b=(t=>(t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t))(b||{});const ce={[0]:{i:-1,j:0},[1]:{i:1,j:0},[2]:{i:0,j:-1},[3]:{i:0,j:1}};function L(t,e){return{i:t.i+e.i,j:t.j+e.j}}function fe(t,e){const{i:o,j:s}=t;return{i:s,j:e-1-o}}const de=[{key:"O",colour:"gold",shape:[[1,1],[1,1]]},{key:"S",colour:"green",shape:[[0,1,1],[1,1,0],[0,0,0]]},{key:"Z",colour:"red",shape:[[1,1,0],[0,1,1],[0,0,0]]},{key:"L",colour:"orange",shape:[[1,1,1],[1,0,0],[0,0,0]]},{key:"J",colour:"blue",shape:[[1,1,1],[0,0,1],[0,0,0]]},{key:"T",colour:"purple",shape:[[1,1,1],[0,1,0],[0,0,0]]},{key:"I",colour:"teal",shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]}],T=new Map(de.map(({shape:t,...e})=>[e.key,{...e,shape:ae(t)}]));function ue(t){const{rows:e,columns:o}=t.shape;if(e!==o)throw new Error("Tetromino geometries must be represented as a square 2d matrix");const s=new H(e,e,0);for(const[i,r,n]of t.shape.entries()){const{i:f,j:l}=fe({i,j:r},e);s.cells[f][l]=n}return s}const he=[[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]],pe=[[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]]];function me(t){switch(t){case 3:return he;case 4:return pe;default:throw new Error(`No offsets defined for size ${t}`)}}function ye(t){for(let e=t.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1)),s=t[o];t[o]=t[e],t[e]=s}}class ge{constructor(e){m(this,"keys");m(this,"bag");m(this,"next");this.keys=[...e],this.bag=[...e],this.next=0,this.fillBag()}fillBag(){this.next=0,ye(this.bag)}peek(){return this.bag[this.next]}take(){const e=this.bag[this.next++];return this.next===this.bag.length&&this.fillBag(),e}}class we extends H{constructor({rows:e,columns:o}){super(e,o,"")}hasTetrominoCollided(e){let o=!1;for(const[s,i]of e.type.shape.keys(r=>!!r)){const{i:r,j:n}=e.position,f=r+s,l=n+i,a=0<=f&&f<this.rows,c=0<=l&&l<this.columns;if(!a||!c){o=!0;break}if(this.cells[f][l]){o=!0;break}}return o}move(e,o){const s=ce[o],i=L(e.position,s),r=!this.hasTetrominoCollided({...e,position:i});return r&&(e.position=i),r}rotateRight(e){const{rows:o}=e.type.shape;if(o===2)return e;const s=e.rotation,i={...e,rotation:(s+1)%4,type:{...e.type,shape:ue(e.type)}},r=me(o)[s];for(const[n,f]of r){const l={...i,position:L(e.position,{i:n,j:f})};if(!this.hasTetrominoCollided(l))return l}return e}affix(e){for(const[o,s]of e.type.shape.keys(i=>!!i)){const i=e.position.i+o,r=e.position.j+s;this.cells[i][r]=e.type.colour}}isRowCompleted(e){for(const o of this.cells[e])if(!o)return!1;return!0}findCompletedRows(){const e=[];for(let o=this.rows-1;o>=0;o--)this.isRowCompleted(o)&&e.push(o);return e}clearCompletedRows(){const e=this.findCompletedRows();for(const i of e)for(let r=0;r<this.columns;r++)this.cells[i][r]="";if(!e)return 0;const o=new Set(e),s=[...[...e.reverse()].map(i=>this.cells[i]),...this.cells.filter((i,r)=>!o.has(r))];for(const[i,r]of s.entries())this.cells[i]=r;return e.length}}class ve{constructor(){m(this,"SOFT_DROP_CELL",1);m(this,"HARD_DROP_CELL",2);m(this,"LINES_CLEARED",{1:100,2:300,3:500,4:800});m(this,"_score",0)}get score(){return this._score}reset(){this._score=0}addSoftDrop(){this._score+=this.SOFT_DROP_CELL}addHardDrop(e){this._score+=this.HARD_DROP_CELL*e}addLinesCleared(e){e!==0&&(this._score+=this.LINES_CLEARED[e])}}class Oe{constructor({rows:e,columns:o}){m(this,"field");m(this,"next");m(this,"ghostPosition");m(this,"activeHold");m(this,"holdAllowed",!0);m(this,"generator");m(this,"gameOver",!1);m(this,"score");this.field=new we({rows:e,columns:o}),this.score=new ve,this.generator=new ge([...T.keys()]),this.spawnTetronimo()}previewTetromino(){const e=this.generator.peek();return T.get(e)}spawnTetronimo(e){e||(e=this.generator.take());const o=T.get(e);this.next={position:{i:-1,j:Math.floor((this.field.columns-o.shape.columns)/2)},rotation:0,type:o},this.alignGhost()}attemptHold(){if(!this.holdAllowed)return!1;const e=this.activeHold,o=this.next.type.key;return this.activeHold=T.get(o),this.holdAllowed=!1,this.spawnTetronimo(e==null?void 0:e.key),!0}alignGhost(){this.ghostPosition=this.calculateLockPosition()}attemptRotateRight(){const e=this.field.rotateRight(this.next);this.field.hasTetrominoCollided(e)||(this.next=e,this.alignGhost())}attemptMove(e){const o=this.field.move(this.next,e);this.alignGhost(),e===b.Down&&o&&this.score.addSoftDrop()}applyGravity(){if(!this.field.move(this.next,b.Down)){if(this.next.position.i===-1){this.gameOver=!0;return}this.field.affix(this.next);const o=this.field.clearCompletedRows();this.score.addLinesCleared(o),this.holdAllowed=!0,this.spawnTetronimo()}}calculateLockPosition(){let e;for(e=1;e<this.field.rows+1;e++){const o={...this.next,position:L(this.next.position,{i:e,j:0})};if(this.field.hasTetrominoCollided(o)){e--;break}}return L(this.next.position,{i:e,j:0})}hardDrop(){const e=this.calculateLockPosition(),o=e.i-this.next.position.i;this.next={...this.next,position:e},this.score.addHardDrop(o)}}const _=.4,Le=`rgba(255,255,255,${_})`,Ee=`rgba(255,255,255,${_})`,be=`rgba(63,63,63,${_})`,ke=`rgba(63,63,63,${_})`,Ce=[Le,Ee,be,ke],Re=.33,je=1;function Te(t,e,o){const{field:s,next:i}=t,n=["field","preview","hold"].reduce((l,a)=>{const c=e[a],d=c.getContext("2d");return d.clearRect(0,0,c.width,c.height),l[a]=d,l},{});for(const[l,a,c]of s.entries(d=>!!d))k(n.field,{i:l,j:a},c,o);n.field.globalAlpha=Re;for(const[l,a]of i.type.shape.keys(c=>!!c))k(n.field,L(t.ghostPosition,{i:l,j:a}),i.type.colour,o);n.field.globalAlpha=je;for(const[l,a]of i.type.shape.keys(c=>!!c))k(n.field,L(i.position,{i:l,j:a}),i.type.colour,o);const f=t.previewTetromino();for(const[l,a]of f.shape.keys(c=>!!c))k(n.preview,L({i:0,j:0},{i:l,j:a}),f.colour,o);if(t.activeHold)for(const[l,a]of t.activeHold.shape.keys(c=>!!c))k(n.hold,L({i:0,j:0},{i:l,j:a}),t.activeHold.colour,o);e.score.innerHTML=`${t.score.score}`}function k(t,{i:e,j:o},s,i){t.fillStyle=s;const r=o*i,n=e*i;t.fillRect(r,n,i,i);const f=r+i,l=n+i,a=Math.floor(i*.125),c=[r,f],d=[n,l],p=[r+a,f-a],O=[n+a,l-a];for(let g=0;g<4;g++){const w=g/2>>0,Y=g%2,R=w^Y,I=1-R;t.fillStyle=Ce[g],t.beginPath(),t.lineTo(c[w],d[R]),t.lineTo(p[w],O[R]),t.lineTo(p[I],O[w]),t.lineTo(c[I],d[w]),t.lineTo(c[w],d[R]),t.closePath(),t.fill()}}function xe(t){const o=()=>new Oe({rows:20,columns:10});let s=o();const i={rows:2,columns:4},r=document.getElementById(t),n={root:r,field:r.querySelector(".field"),preview:r.querySelector(".preview canvas"),hold:r.querySelector(".hold canvas"),score:r.querySelector(".score-value")},f={field:s.field,preview:i,hold:i};for(const[c,d]of Object.entries(f)){const p=n[c];p.width=40*d.columns,p.height=40*d.rows}const l=()=>{Te(s,n,40)};setInterval(()=>{l(),s.applyGravity(),s.gameOver&&(alert(`Game over :(
Press ok to start a new game`),s=o())},500);const a=new Map([["left",()=>s.attemptMove(b.Left)],["right",()=>s.attemptMove(b.Right)],["up",()=>s.attemptRotateRight()],["down",()=>s.attemptMove(b.Down)],["space",()=>s.hardDrop()],["shift,h",()=>s.attemptHold()],["n",()=>{s=o()}]]);for(const[c,d]of a.entries())v(c,p=>{p.preventDefault(),d(),l()})}xe("tetris");
